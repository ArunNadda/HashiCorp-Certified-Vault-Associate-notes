## Auth Methods
- components that perform authentication to vault.
- responsible for assigning identity and policy to a user
- multiple auth methods can be enabled as per usecase
- Auth methods are enabled at a 'path' - commonly using same name as the auth method.
- Default auth method for any new install is TOKEN.



- many auth methods.
**Authencation Flow**
-
-
-

**Default Auth Method**
- tokens
- Root token is assigned the root policy upon init.
- Root token should not be used on a day-to-day basis
- After enabling other auth methods, create your own 'admin' and delete the root token
```
$ vault token revoke xxxxxxxx.xxx.xx
```

**correct auth method to use**
- based on environment
- try to use same method for similar apps.
- Humans:
    - LDAP
    - Userpass
    - Okta
- Machines:
    - approle
    - aws
    - token
-

**Tokens**
- Tokens are core method are auth within vault
- can be used directly or generated by another auth method
- Vault verifies identity and then generates a unique token to associate with that identity for future requests.
- The CLI and UI automatically attach this token, but API requires this to be manually done.

```
$ vault token lookup
```

- A token accessor is created alongside the token and serves as reference to the token. The token accessor can be used to:
   - Lookup token capabilities
   - Lookup token properties
   - Revoke the token

- Non-Root token has an associated TTL
- After TTL is expired, the token is revoked.
- Tokens can be renewed, if permitted.
```
$ vault token renew
```
- Token can have a Max TTL, which is a hard limit on the life of the token itself.


**Token Hierarchy**
- When a new token is created, it is a child of the creator
- If the paranet is removed or expired, so do all its child tokens.
- Parent is almost always a token.
- Child can be a token, secret, or auth created by parent.



**Service vs Zbatch Token**
- Service TOkens are "normal" tokens and interacted with most of the times.

- Batch Tokens are encrypted blobs which has just enough info to be used with Vault.
  - Lightweight and scalable
  - Lack most of the flexibility and features of service tokens.
  - Dont require storage on disk to track
  - used for ephermal, high performance workloads
  - Good for large batches of perrations, like the transit secret engine


**LDAP Auth Method**
- most freq auth method in ent
- Mostly used for user auth.
- Point to LDAP servers for authentication
     - Can supply multiple servers, will be used in order
     - Identify the user attribute (CN or sAMAccountName)
     - configure group filter and group DN for searching group membership
- Map a group to an AD group and assign Vault policy


```
$ vault read auth/ldap/config
$ vault write auth/ldap/config xxxxx
```

**Userpass Auth Method**
- Not used in Ent, but for PoC or Demo
- Starts up a local db of users/pwds
- Cannot read usernames and passwords from external sources.


```
$ vault auth enable userpass
$ vault write auth/userpass/users/akn password=aknpwd policies=test_admins

$ vault list auth/userpass/users
$ vault read auth/userpass/users/akn


$ vault login -method=userpass username=akn

$ vault token lookup
```


**AppRole Auth Method**
- Ideal for machine to machine. used by applications.
- like user/pwd but for machines
  - RoleID - identifiers for specific role
      - not sensitive
      - can be embedded in AMI,Code,dockerfile etc
  - SecretID - credential required for login
      - is sensitive, sould be unique to each client
      - can be delivered by orcherastor, config management tools.
  - together: RoleID + SecredID = Vault Token
